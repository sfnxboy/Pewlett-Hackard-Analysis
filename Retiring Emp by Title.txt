--Retiring Emp by Title

-- DELIVERABLE 1: Create a Retirement Titles table that holds all the titles of employees 
-- who were born between January 1, 1952 and December 31, 1955.

SELECT DISTINCT ON (e.emp_no) e.emp_no,
e.first_name,
e.last_name,
t.title,
t.from_date,
t.to_Date
INTO unique_titles
FROM employees AS e
INNER JOIN title AS t ON (e.emp_no = t.emp_no)
WHERE (birth_date BETWEEN '1952-01-01' AND '1955-12-31')
ORDER BY e.emp_no, t.title DESC;

-- Find total count of employees by their most-recent job title who are about to retire

SELECT COUNT(title)
FROM retiring_titles
WHERE (from_date BETWEEN '1985-01-01' AND '1988-12-31');

-- Sort the Unique Titles table in ascending order by the employee 
-- number and descending order by the last date of the most recent title.

DELETE TABLE unique_titles;
SELECT DISTINCT ON (e.emp_no) e.emp_no,
e.first_name,
e.last_name,
t.title,
t.from_date,
t.to_Date
INTO unique_titles
FROM employees AS e
INNER JOIN title AS t ON (e.emp_no = t.emp_no)
WHERE (birth_date BETWEEN '1952-01-01' AND '1955-12-31')
AND (hire_date BETWEEN '1985-01-01' AND '1988-12-31')
ORDER BY e.emp_no, t.to_date DESC;

-- Write another query in the file to retrieve the number of employees 
-- by their most recent job title who are about to retire.

SELECT COUNT(ut.emp_no), ut.title
INTO retiring_titles_count
FROM unique_titles AS ut
GROUP BY ut.title
ORDER BY COUNT(ut.emp_no) DESC;